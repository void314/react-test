import React, { useEffect, useState } from "react";
import { useDispatch, useSelector } from "react-redux";
import styled, { keyframes } from "styled-components";
import animation from "react-animations/lib/swing";
import { primaryColor } from "../containers/Products";
import { cartTotalSelector } from "../store/selectors";
import { toggle } from "../store/uiSlice";

const styledAnimation = keyframes`${animation}`;

const NavContainer = styled.div`
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 3;
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  height: 60px;
  padding: 0 20px;
  background: #333;
  color: #fff;
`;

const NavTitle = styled.h1`
  display: flex;
  align-items: center;
  margin: 0;
  padding-right: 8px;
  flex: 1;
  font-size: 18px;
  user-select: none;

  svg {
    margin-right: 8px;
  }
`;

const NavIconWrapper = styled.div`
  position: relative;
`;

const Bubble = styled.div`
  position: absolute;
  top: -40%;
  right: -40%;
  padding: 0 4px;
  height: 20px;
  font-size: 12px;
  line-height: 20px;
  text-align: center;
  background-color: ${primaryColor};
  border-radius: 2px;
  animation: ${(p) => (p.change ? styledAnimation : null)} 1s;
`;

const Nav = () => {
  const total = useSelector(cartTotalSelector);
  const dispatch = useDispatch();
  const [change, setChange] = useState(false);

  useEffect(() => {
    if (total !== 0) {
      setChange(true);

      setTimeout(() => {
        setChange(false);
      }, 1000);
    }
  }, [total]);

  return (
    <NavContainer>
      <NavTitle>
        <svg
          t="1606124845716"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4360"
          width="32"
          height="32"
          fill="#fff"
        >
          <path
            d="M709.76 704.170667c37.077333-3.2 65.834667-35.84 63.957333-74.837334-1.962667-38.997333-33.92-70.314667-72.874666-70.314666h-2.602667a72.96 72.96 0 0 0-70.314667 75.477333c1.28 20.437333 9.642667 37.077333 21.077334 49.194667-44.714667 86.954667-111.829333 150.869333-213.504 204.586666-68.394667 35.754667-140.629333 49.237333-210.944 39.637334-58.794667-8.277333-104.789333-34.56-132.949334-76.714667-42.154667-63.957333-45.994667-132.949333-10.88-201.984 25.642667-49.877333 63.957333-86.314667 89.557334-104.234667a424.96 424.96 0 0 1-17.92-65.792C-36.906667 614.741333-17.664 800.085333 39.850667 887.68c42.837333 63.914667 130.432 104.789333 226.304 104.789333 25.557333 0 52.437333-1.877333 78.634666-8.277333 166.229333-31.957333 292.138667-131.669333 364.373334-278.698667l0.597333-1.322666z m228.181333-159.829334c-99.029333-116.352-244.821333-180.266667-411.050666-180.266666h-21.76c-10.794667-23.637333-35.712-38.357333-63.872-38.357334h-1.92c-40.234667 0-71.594667 34.56-70.272 74.794667 1.28 38.314667 33.877333 70.314667 72.874666 70.314667h3.157334a72.106667 72.106667 0 0 0 63.914666-44.757334h23.68c98.517333 0 191.786667 28.757333 276.821334 84.992 65.152 42.837333 111.872 99.072 138.069333 166.229334 22.954667 54.954667 21.717333 108.672-1.92 153.472-36.437333 70.272-97.834667 107.392-178.986667 107.392-51.157333 0-100.992-16-126.592-27.477334-15.317333 12.714667-40.917333 33.834667-59.477333 46.634667 56.234667 25.514667 113.152 40.234667 168.106667 40.234667 124.672 0 217.301333-70.272 252.501333-138.069334 38.314667-76.714667 35.157333-205.824-62.677333-316.416l-0.597334 1.28zM276.992 727.125333a73.557333 73.557333 0 0 0 72.874667 70.314667h2.56a72.021333 72.021333 0 0 0 70.314666-75.434667c0-38.357333-33.237333-70.272-72.234666-70.272h-2.602667c-2.56 0-6.357333 0-9.6 1.237334-53.034667-89.514667-75.434667-185.429333-67.072-288.896 5.077333-77.994667 30.677333-145.792 76.672-202.026667 38.357333-47.957333 110.592-71.637333 159.829333-72.874667 138.069333-2.602667 195.626667 169.429333 200.064 237.824l63.914667 19.157334c-14.72-209.664-145.066667-319.658667-269.738667-319.658667-116.992 0-224.981333 85.034667-268.501333 209.706667-59.434667 166.229333-20.437333 326.016 52.437333 453.888-6.357333 8.32-10.197333 22.997333-8.917333 37.034666z"
            p-id="4361"
          ></path>
        </svg>
        Redux-toolkit Cart Demo
      </NavTitle>
      <NavIconWrapper
        onClick={() => {
          dispatch(toggle());
        }}
      >
        <Bubble change={change}>{total}</Bubble>
        <svg
          t="1606123426950"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          p-id="4119"
          width="24"
          height="24"
          fill="#fff"
        >
          <path
            d="M1003.442802 167.945013c-9.960863-11.328-23.089881-17.323551-37.997406-17.323551l-752.437048 0C202.701608 92.595908 150.935618 47.89073 91.855034 47.89073L24.385387 47.89073c-12.900821 0-23.340591 10.43977-23.340591 23.340591s10.43977 23.340591 23.340591 23.340591l67.469648 0c38.08848 0 71.549569 29.860075 76.381621 69.156056l33.232892 191.808514 58.921971 414.867776c3.418866 28.514427 28.560476 51.696406 56.04955 51.696406l609.366561 0c12.900821 0 23.340591-10.43977 23.340591-23.340591 0-12.900821-10.43977-23.340591-23.340591-23.340591L316.441069 775.419482c-3.327792 0-9.003048-4.740978-9.756201-11.07729l-11.478426-80.802304 112.454188-9.484002 485.847363-35.877115c31.888268-0.182149 59.833737-24.52558 63.434751-54.248531l62.751183-359.251084C1022.202051 203.822129 1015.95579 182.054359 1003.442802 167.945013z"
            p-id="4120"
          ></path>
          <path
            d="M849.442382 894.790196c-34.740222 0-63.005986 28.265764-63.005986 63.001893 0 34.716686 28.28009 62.977333 63.005986 62.977333 34.69622 0 62.972217-28.266787 62.972217-62.977333C912.414599 923.05596 884.152928 894.790196 849.442382 894.790196z"
            p-id="4121"
          ></path>
          <path
            d="M355.396289 894.790196c-34.740222 0-63.004963 28.265764-63.004963 63.001893 0 34.716686 28.28009 62.977333 63.004963 62.977333 34.69622 0 62.972217-28.266787 62.972217-62.977333C418.368506 923.05596 390.108882 894.790196 355.396289 894.790196z"
            p-id="4122"
          ></path>
        </svg>
      </NavIconWrapper>
    </NavContainer>
  );
};

export default Nav;
